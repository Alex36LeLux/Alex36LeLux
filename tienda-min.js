function AddTarjeta(a){var e=paisSelected();if(l=1,$(".selectqty").val()&&(l=$(".selectqty").val()),fComprador=$("#tarjetacomprador").val(),fDestinatario=$("#tarjetadestinatario").val(),fEmailDestino=$("#tarjetaemaildestinatario").val(),fImporte=$("#tarjetaimporte").val(),fMensaje=$("#tarjetamensaje").val(),chivatoAdd){var t={idproducto:a,cantidad:l,observaciones:"",importe:fImporte,comprador:fComprador,destinatario:fDestinatario,emaildestinatario:fEmailDestino,mensajefelicitacion:fMensaje,idpais:e,csrfmiddlewaretoken:CSRFTOKEN},r=OtrosParam(),o=Object.assign(t,r);$.ajax({type:"POST",url:PREFIJO_IDIOMA+"/cart/add",data:o,success:parseCarrito,dataType:"json"}),avolar(a),$("#txTallasElegidas").html(""),$("#observaciones").val("");var s=fImporte,l=1;dtlayerAddtocart(l,"tarjeta-regalo","Tarjeta de regalo",s,"Ideas para regalar")}}function parseCarrito(a){$(".carritoCont").text(""),latabla="",contador=0;for(var e=a.productos,t=0,r=e.length;t<r;t++){var o=e[t],s=new String(o.nombre),l=30,i="";250==o.idgrupo&&(i="hide",l=42),latabla+='<a href="'+o.url+'">\x3c!-- cart item --\x3e',o.imagen?latabla+='<img src="'+STATICMEDIA+"/"+o.imagen+'"  height="45" alt="'+s+'" title="'+s+'" />':latabla+='<img src="'+STATICMEDIA+'/PrNoDisp.jpg"  height="45" alt="'+s+'" title="'+s+'" />',latabla+='<span class="titulosh h6">',latabla+='<span class="'+i+'"><span class="quantity ">'+o.cantidad+"</span>x</span> "+s.substring(0,l),latabla+="</span>",latabla+="<small class="+i+">"+o.precio+" €  &nbsp;&nbsp;&nbsp;<span class='float-right'>("+o.importe+" €)</span>  </small>",latabla+="</a>\x3c!-- /cart item --\x3e",contador+=parseInt(o.cantidad)}latabla+="",$(".carritoCont").html(latabla),$(".nItemsCarrito").text(a.elementos),$(".SubtotalCarrito").text(a.subtotal),$(".ImporteTotalCarrito").text(a.total)}function refrescaCarrito(a){void 0===a&&(a="desconocido");var e=paisSelected(),t={csrfmiddlewaretoken:CSRFTOKEN,idpais:e,OrigenLlamada:a},r=OtrosParam(),o=Object.assign(t,r);$.ajax({type:"POST",url:PREFIJO_IDIOMA+"/cart/get",data:o,success:parseCarrito,dataType:"json"}),LZTIC_canarias=ValorParam("canarias"),1==LZTIC_canarias?$(".txEsCanarias").html("Canarias"):$(".txEsCanarias").html("")}function avolar(a){$("body,html").animate({scrollTop:0},1e3),imagen=$("img[idproducto='"+a+"']");var e=$(".bolsa").offset().left-imagen.offset().left,t=187-imagen.offset().top,r=imagen.width()/4,o=imagen.height()/4;imagen.clone().prependTo("#im"+a).css({position:"absolute","z-index":"10000"}).animate({opacity:1},100).animate({opacity:0,marginLeft:e,marginTop:t,width:r,height:o},1e3,"linear",(function(){$(this).remove()})),$(".nItemsCarrito").css("color","red"),$(".bolsa").shake(10,6,400)}function refrescaCarro(a){void 0===a&&(a="desconocido");var e=paisSelected(),t={csrfmiddlewaretoken:CSRFTOKEN,idpais:e,OrigenLlamada:a},r=OtrosParam(),o=Object.assign(t,r);$.ajax({type:"POST",url:PREFIJO_IDIOMA+"/cart/get",data:o,success:parseCarro,dataType:"json"})}function parseCarro(a){parseCarrito(a),latabla="",latabla2="",contador=0;for(var e=a.productos,t=0,r=e.length;t<r;t++){var o=e[t];if(PrId=o.id,PrIdgrupo=o.idgrupo,PrNombre=o.nombre,PrNombreRec=PrNombre.substring(0,30),PrPrecio=o.precio,PrCantidad=o.cantidad,PrImagen=o.imagen,PrImporte=o.importe,PrUrl=o.url,PrEsTarjReg=1==o.estarjetaregalo,PrCateg=o.categoriaprincipal,PrCodigo=o.referencia,PrPrecioProd=o.precio,PrPrecioOriginalImp=o.precio_original_con_impuestos,PrImpuestosPro=o.impuestos_producto,PrRegalo="1"==o.regalo,PrPrecioOrig=o.precio_original,PrPrecioOrigFinal=o.precio_original_final,PrPimpuestoLinea=o.impuestos_linea,PrPimpuestotipo=o.pimpuestos,Prdescuento_blackfriday_lin="","0.00"!=o.descuento_blackfriday&&(Prdescuento_blackfriday_lin='<span class="text-gray"> - '+o.descuento_blackfriday+"€ <small>( 5% Dsc. )</small> </span> "),txDetalleImpuestos=PrImpuestosPro+"&euro; <small>("+PrPimpuestotipo+"% )</small>",EsPack=o.pack,EsPack){txDetalleImpuestos="";for(var s=o.desglose_impuestos,l=0,i=s.length;l<i;l++)PrIm=s[l],0!=l&&(txDetalleImpuestos+=" + "),txDetalleImpuestos+=PrIm.valor+"&euro; <small>("+PrIm.tipo+"%)</small>"}PrPrecioProd!=PrPrecioOriginalImp?txPrecioOriginal='<em class="text-gray tachado mr-10">'+PrPrecioOriginalImp+"&euro;</em> ":txPrecioOriginal="",txPrMensaje="",o.mensaje&&(txPrMensaje='<span class="badge badge-info ">'+o.mensaje+"</span>");var n="";PrEsTarjReg&&(n="<br/><small>"+jQuery.parseJSON(o.observaciones).destinatario+"</small>",PrUrl="#"),claseBtMenos="label-default",1==PrCantidad&&(claseBtMenos=" "),PrImagen?PrImagen=STATICMEDIA+"/"+PrImagen:PrImagen=STATICMEDIA+"/PrNoDisp.jpg",latabla+=' \x3c!-- cart item --\x3e<div class="item lineaArticulo" id="lin'+PrId+'"  data-nombre="'+PrNombre+'" data-codigo="'+PrCodigo+'"  data-precio="'+PrPrecio+'"  data-categoria="'+PrCateg+'">',latabla+='  <div class="cart_img float-left fw-100 p-10 text-left">';var d='<img src="'+PrImagen+'" alt="'+PrNombre+'" title="'+PrNombre+'" class="imgthumbcarro" width="80"/>';PrRegalo?latabla+=d:latabla+='<a href="'+PrUrl+'">'+d+"</a>",latabla+="   </div>",PrRegalo?(latabla+='  <a href="#" class="product_name pl-0 pr-0">',latabla+="    <span>"+PrNombre+"</span>",latabla+=txPrMensaje,latabla+="   </a>"):(latabla+='  <a href="'+PrUrl+'" class="product_name">',latabla+="    <span>"+PrNombre+n+"</span>",latabla+="   <br><span class='bold'> "+txPrecioOriginal+PrPrecio+"&euro;</span>",latabla+=' <br><em class="text-gray small">'+PrPrecioOrigFinal+"&euro;"+Prdescuento_blackfriday_lin+" + ",latabla+=txDetalleImpuestos+" = "+PrPrecio+"&euro;",latabla+="</em>",latabla+=txPrMensaje,latabla+="   </a>"),clOculto="",250==PrIdgrupo&&(clOculto="hide"),PrPrecio>0||PrRegalo&&PrEsTarjReg?latabla+=' <a href="#" idproducto="'+PrId+'"  origen="vercesta" class="remove_item botonRem  refresca btCalculaportes"><i class="fa fa-trash-o "></i></a>':latabla+=' <a href="#" class="remove_item "><i class="fa fa-gift"  title="'+TRANSREGALO+'"></i></a>',latabla+='  <div class="total_price total '+clOculto+'"><strong>'+PrImporte+" &euro;</strong></div>",latabla+=' <div class="qty '+clOculto+'">',PrPrecio>0&&!PrEsTarjReg?latabla+='<a href="#" class="actBoton menosArt btCalculaportes  label '+claseBtMenos+' soloencarro" idproducto="'+PrId+'"   > - </a> ':latabla+="&nbsp;&nbsp;",latabla+='   <input type="number" value="'+PrCantidad+'" name="qty" id="qty_'+PrId+'" maxlength="3" max="999" min="1" idproducto ="'+PrId+'" readonly />',PrPrecio>0&&!PrEsTarjReg?latabla+=' <a href="#" class="actBoton masArt label label-default btCalculaportes soloencarro" idproducto="'+PrId+'"  > + </a>':latabla+="&nbsp;&nbsp;",latabla+="</div>",latabla+=' <div class="clearfix"></div>',latabla+="</div>\x3c!-- /cart item --\x3e"}latabla+="",$(".contentCarro").html(latabla),PonerTotales(a),ActualizaPortes(!1,"tienda.js al final de ParseCarro")}function PonerTotales(a){if($("#Subtotal").html(a.subtotal_sin_impuestos+" &euro;"),$("#Impuestos").html(a.impuestos_lineas+" &euro;"),$("#Descuento").html("-"+a.descuento+" &euro;"),parseFloat(a.descuento)>0?$(".lineaDescuento").removeClass("hide"):$(".lineaDescuento").addClass("hide"),0==$(".lineaArticulo").length?($("#avisoAgotado").html(" Su carrito está vacío, debe agregar algún artículo "),$("#avisoAgotado").fadeIn(1e3),$(".carritovacio").removeClass("hide")):$(".carritovacio").addClass("hide"),a.total<a.pedidominimo)"undefined"!=typeof mostrarAvisoPedidoMin&&mostrarAvisoPedidoMin("#RecordarPedidominimo",a.pedidominimo);else if(a.total<80){var e=new Date,t=new Date("2018-12-9"),r=new Date("2018-12-31");t<=e&&e<=r&&"undefined"!=typeof mostrarAvisoPedidoMin&&mostrarAvisoPedidoMin("#AvisoSorteo80",80)}a.subtotal<120?$("#contenedorMuestras").addClass("hide"):$("#contenedorMuestras").removeClass("hide"),!0===a.promo_blackfriday?$("#contenedorBF").removeClass("hide"):($("#contenedorBF").addClass("hide"),$("#BFPROMO_cesta").prop("checked",!1),GuardaParam({blackfriday:0}))}function actualiza(a,e){var t={idproducto:a,cantidad:e,idpais:paisSelected(),observaciones:"",csrfmiddlewaretoken:CSRFTOKEN},r=OtrosParam(),o=Object.assign(t,r);$.ajax({type:"POST",url:PREFIJO_IDIOMA+"/cart/add",data:o,success:parseCarro,dataType:"json"})}function calculaportesycupon(a,e,t,r,o,s,l){s=s||null,l=l||null;e||(e=0),$(".loading").removeClass("hide"),$(".limpiarvalor").html("");var i={pais:a,poblacion:e,codpostal:t,cupon:r,Origenllamada:o};null!=s&&(i.tarjeta=s,i.pintarjeta=l);var n=OtrosParam(),d=Object.assign(i,n);$.ajax({url:PREFIJO_IDIOMA+"/portes",type:"GET",data:d,crossDomain:!0,async:!0,dataType:"json",success:function(a){var e=a;$("#Subtotal").html(e.subtotal_sin_impuestos+" &euro;"),$("#Impuestos").html(e.impuestos_lineas+" &euro;"),$("#GastosEnvio").html(e.portes+" &euro;"),$("#ImporteCupon").html("-"+e.importecupon+" &euro;"),$("#ImporteTotal").html(e.total+" &euro;"),$("#Descuento").html("-"+e.descuento+" &euro;"),$("#Fimportecupon").val(e.importecupon),$("#Fgastosenvio").val(e.portes),$("#Fdescuento").val(e.descuento),null!=s?($("#saldotarjeta").html(e.saldotarjeta+" &euro;"),parseFloat(e.saldotarjeta)>0?$("#saldotarjeta").removeClass("text-danger").addClass("text-success"):$("#saldotarjeta").removeClass("text-success").addClass("text-danger"),$("#ImporteRegalo").html(e.regalo+" &euro;"),$("#ImportePago").html(e.importepago+" &euro;"),$(".cajaSaldoTarjeta").removeClass("hide")):($("#saldotarjeta").html("0.00 &euro;"),$(".cajaSaldoTarjeta").addClass("hide"),$(".labelmetodopago_1").removeClass("text-warning"),$("#metodopago_1").removeAttr("disabled")),e.errortarjeta?($(".cajaSaldoTarjeta").addClass("hide"),$(".errortarjeta").removeClass("hide")):($(".errortarjeta").addClass("hide"),null!=s&&($(".labelmetodopago_1").addClass("text-warning"),$("#metodopago_1").attr("disabled","disabled"))),e.addregalocupon&&$("#mensajecupon").show(),$(".loading").addClass("hide"),parseFloat(e.importecupon)>0?$(".lineaDescuentocupon").removeClass("hide"):$(".lineaDescuentocupon").addClass("hide"),parseFloat(e.descuento)>0?$(".lineaDescuento").removeClass("hide"):$(".lineaDescuento").addClass("hide")},error:function(a,e){}})}function clavevalida(a){return clavesegura=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[.!@#$%^&*])(?=.{8,})"),a.length>=4}function emailvalido(a){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}function limpiaemail(a){return a.replace(/ /g,"").toLowerCase()}function paisSelected(){var a="67";return""!=$(".selpais").val()&&(a=$(".selpais").val()),a}function GuardaCanarias(a){GuardaParam({canarias:157==a||170==a?1:0})}function GuardaParam(a){if(null!=a){var e={};if(null===localStorage.getItem("LZTIC_otrosparam"))e=a;else{var t=JSON.parse(localStorage.getItem("LZTIC_otrosparam"));e=Object.assign(t,a)}var r=JSON.stringify(e);localStorage.setItem("LZTIC_otrosparam",r)}}function OtrosParam(){var a={};return window.localStorage&&localStorage.getItem("LZTIC_otrosparam")&&(a=JSON.parse(localStorage.getItem("LZTIC_otrosparam"))),a}function ValorParam(a){return OtrosParam()[a]}$(".botonAdd").click((function(){var a=paisSelected();iproducto=$(this).attr("idproducto"),vcantidad=1,$(".selectqty").val()&&(vcantidad=$(".selectqty").val());var e={idproducto:iproducto,cantidad:vcantidad,observaciones:"",idpais:a,csrfmiddlewaretoken:CSRFTOKEN},t=OtrosParam(),r=Object.assign(e,t);if(chivatoAdd){$.ajax({type:"POST",url:PREFIJO_IDIOMA+"/cart/add",data:r,success:parseCarrito,dataType:"json"}),avolar(iproducto),$("#txTallasElegidas").html(""),$("#observaciones").val(""),fbq("track","AddToCart");var o=$(this).data("codigo"),s=$(this).data("precio"),l=$(this).data("nombre"),i=$(this).data("categoria");dtlayerAddtocart(vcantidad,o,l,s,i)}})),$(document).on("click",".botonRem",(function(){var a=paisSelected();iproducto=$(this).attr("idproducto"),vOrigen=$(this).attr("origen");var e={idproducto:iproducto,idpais:a,csrfmiddlewaretoken:CSRFTOKEN},t=OtrosParam(),r=Object.assign(e,t);$.ajax({type:"POST",url:PREFIJO_IDIOMA+"/cart/remove",data:r,success:function(a){"vercesta"==vOrigen?parseCarro(a):parseCarrito(a)},dataType:"json"});var o=$("#qty_"+iproducto).val();dtlayerRemoveFromCart(iproducto,o)})),jQuery.fn.shake=function(a,e,t){return this.each((function(){$(this).css("position","relative");for(var r=1;r<=a;r++)$(this).animate({left:-1*e},t/a/4).animate({left:e},t/a/2).animate({left:0},t/a/4)})),this},$(".contentCarro").on("click",".actBoton",(function(){idproducto=$(this).attr("idproducto"),cantidadActual=$("#qty_"+idproducto).val(),vcantidad=1,$(this).hasClass("menosArt")&&(vcantidad=-1),parseInt(cantidadActual)+parseInt(vcantidad)!=0&&(actualiza(idproducto,vcantidad),dtl_AddProductCarrito(idproducto,vcantidad))})),$(".required").focus((function(){$(this).removeClass("error")}));